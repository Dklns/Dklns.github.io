<h1 id="int指令"><a class="anchor" href="#int指令">#</a> int 指令</h1>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040266569-4ffb899f-743f-42d6-8c86-9b7a7d52f601.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040266569-4ffb899f-743f-42d6-8c86-9b7a7d52f601.png" /></p>
<h3 id="bios和dos所提供的中断例程"><a class="anchor" href="#bios和dos所提供的中断例程">#</a> BIOS 和 DOS 所提供的中断例程</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040564714-4b0384cd-3ff0-4582-9f56-62c21f202db3.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040564714-4b0384cd-3ff0-4582-9f56-62c21f202db3.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040587302-46d384b0-d385-48a1-9a03-194f6d2b9eb7.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040587302-46d384b0-d385-48a1-9a03-194f6d2b9eb7.png" /></p>
<h3 id="bios和dos中断例程的安装过程"><a class="anchor" href="#bios和dos中断例程的安装过程">#</a> BIOS 和 DOS 中断例程的安装过程</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040643898-c2f178d8-f807-4d00-b216-13690d37360a.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040643898-c2f178d8-f807-4d00-b216-13690d37360a.png" /></p>
<h3 id="bios中断例程应用"><a class="anchor" href="#bios中断例程应用">#</a> BIOS 中断例程应用</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040721406-3393d921-33a3-44e8-a695-bd3267550818.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040721406-3393d921-33a3-44e8-a695-bd3267550818.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040738374-cfc3b256-45d0-4a08-bfa4-1f4149cbd1e2.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040738374-cfc3b256-45d0-4a08-bfa4-1f4149cbd1e2.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040744541-3c085d38-085f-4985-a49a-173715d4886c.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040744541-3c085d38-085f-4985-a49a-173715d4886c.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040766207-d5e85a23-2328-456a-a0e0-932ddd6cb3c7.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040766207-d5e85a23-2328-456a-a0e0-932ddd6cb3c7.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040860148-e3beeba9-8fa5-4cfc-b8c8-18c8f176285a.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040860148-e3beeba9-8fa5-4cfc-b8c8-18c8f176285a.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040871285-5435feb2-8994-4fb0-9f53-b99eae91ca58.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040871285-5435feb2-8994-4fb0-9f53-b99eae91ca58.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040878530-9961d49b-f696-46a6-8ba0-0f692da038ab.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040878530-9961d49b-f696-46a6-8ba0-0f692da038ab.png" /></p>
<h3 id="dos中断例程应用"><a class="anchor" href="#dos中断例程应用">#</a> DOS 中断例程应用</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040930677-400bce15-d4e8-4678-8bfd-74bcf690d49b.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040930677-400bce15-d4e8-4678-8bfd-74bcf690d49b.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040998608-a288424d-5a63-4357-8067-ef8b62aa86a3.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648040998608-a288424d-5a63-4357-8067-ef8b62aa86a3.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648041005476-2953281a-59ac-4ce3-8d23-3d6c5dbc3d87.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648041005476-2953281a-59ac-4ce3-8d23-3d6c5dbc3d87.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648041016224-c4143c08-7269-42cf-94e8-4963837790fe.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648041016224-c4143c08-7269-42cf-94e8-4963837790fe.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648041029867-f2a75bff-7278-4ac5-83d6-5fd952916581.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648041029867-f2a75bff-7278-4ac5-83d6-5fd952916581.png" /></p>
<h3 id="实验-给int-7ch安装显示字符串的中断处理"><a class="anchor" href="#实验-给int-7ch安装显示字符串的中断处理">#</a> 实验 - 给 int 7ch 安装显示字符串的中断处理</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648086756835-07832e3c-146b-4229-b559-fb5a1d2fd9ba.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648086756835-07832e3c-146b-4229-b559-fb5a1d2fd9ba.png" /></p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648086766989-5a8440bb-09bd-4375-ae6c-0a828d6bcc0b.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648086766989-5a8440bb-09bd-4375-ae6c-0a828d6bcc0b.png" /></p>
<pre><code>assume cs:code

data segment
   db 'welcome to the fuck',0
data ends

code segment
start:
     mov ax,0
     mov es,ax
     mov di,200H

     mov ax,cs
     mov ds,ax
     mov si,offset show

     mov cx,offset showLast - offset show
     cld
     rep movsb

     mov ax,0
     mov es,ax
     mov word ptr es:[7ch * 4],200H
     mov word ptr es:[7ch * 4 + 2],0

     mov dh,8
     mov dl,4
     mov cl,4
     mov ax,data
     mov ds,ax
     mov si,0
     int 7ch

     mov ax,4c00H
     int 21H

show:
     push ax
     push cx
     push si
     push di
     push ds
     push es

showStart:
     mov ax,0b800h
     mov es,ax
     mov al,160
     mul dh
     mov di,ax
     mov al,2
     mul dl
     add di,ax

     mul dl
     add di,ax
tran:
     push cx        ;由于判断字符是否结束要用cx，而传送字符颜色也要用cx，所以可以先把颜色备份
     mov cx,0
     mov cl,ds:[si]
     jcxz showEnd
     mov es:[di],cl
     pop cx         ;在判断完字符后，需要颜色时再出栈cx
     mov es:[di+1],cl
     inc si
     add di,2
     jmp short tran

showEnd:
     pop es
     pop ds
     pop di
     pop si
     pop cx
     pop ax
     iret

showLast:
     nop

code ends
end start
</code></pre>
<h3 id="实验-intloop"><a class="anchor" href="#实验-intloop">#</a> 实验 - intLoop</h3>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648088964893-b23bafaa-dd97-4ae8-8b03-e3dfcb81bec5.png" alt="https://cdn.nlark.com/yuque/0/2022/png/23204417/1648088964893-b23bafaa-dd97-4ae8-8b03-e3dfcb81bec5.png" /></p>
<p>首先 loop 本身就是根据位移差改变 cs：ip 的</p>
<pre><code>assume cs:code

code segment
start:
     mov ax,0
     mov es,ax
     mov di,200H

     mov ax,cs
     mov ds,ax
     mov si,offset intLoop

     mov cx,offset loopEnd - offset intLoop
     cld
     rep movsb

     mov ax,0
     mov es,ax
     mov word ptr es:[7ch * 4],200H
     mov word ptr es:[7ch * 4 + 2],0

     mov ax,0b800h
     mov es,ax
     mov si,160*8+4*2

     mov cx,80
     mov bx,offset s - offset se
s:   mov byte ptr es:[si],'!'
     add si,2
     int 7ch
se:  nop

     mov ax,4c00h
     int 21h
intLoop:
     push bp         ;这里为什么要用bp呢，因为bp的默认段寄存器是ss，而我们要操作栈中保存的
     mov bp,sp       ;int 7ch执行前的cs：ip，所以用bp要方便一点
     dec cx
     jcxz loopRet
     add [bp+2],bx   ;在栈顶的是bp，之后就是ip，因为调用中断处理程序时入栈顺序是，标志寄存器
loopRet:             ;cs，ip
     pop bp
     iret
loopEnd:
     nop

code ends
end start
</code></pre>
<h3 id="实验-使用bios和dos提供的中断处理程序显示字符串"><a class="anchor" href="#实验-使用bios和dos提供的中断处理程序显示字符串">#</a> 实验 - 使用 BIOS 和 DOS 提供的中断处理程序显示字符串</h3>
<p>10h 的 2 号子程序是改变光标位置</p>
<p>21h 的 9 号子程序是在光标处显示以 '$' 结尾的字符串</p>
<pre><code>assume cs:code

code segment
   s1: db 'Good,btter,best','$'
   s2: db 'Never,let it rest','$'
   s3: db 'Till good is better.','$'
   s4: db 'And better,best.','$'
   s : dw offset s1,offset s2,offset s3,offset s4
   row:db 2,4,6,8
start:
   mov ax,cs
   mov ds,ax
   mov bx,offset s
   mov si,offset row
   mov cx,4
ok:mov bh,0
   mov dh,[si]  ;每次循环要改变光标的位置
   mov dl,0
   mov ah,2
   int 10h

   mov dx,[bx]
   mov ah,9
   int 21h
   add bx,2
   inc si
   loop ok

   mov ax,4c00h
   int 21h
code ends
end start

</code></pre>
