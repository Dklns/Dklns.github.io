<h1 id="前后端的身份认证"><a class="anchor" href="#前后端的身份认证">#</a> 前后端的身份认证</h1>
<h2 id="web开发模式"><a class="anchor" href="#web开发模式">#</a> web 开发模式</h2>
<h3 id="服务端渲染"><a class="anchor" href="#服务端渲染">#</a> 服务端渲染</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled.png" alt="Untitled" /></p>
<h3 id="前后端分离"><a class="anchor" href="#前后端分离">#</a> 前后端分离</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%201.png" alt="Untitled" /></p>
<h3 id="如何选择web开发模式"><a class="anchor" href="#如何选择web开发模式">#</a> 如何选择 web 开发模式</h3>
<p>不谈业务场景而盲目选择使用何种开发模式都是耍流氓。</p>
<ul>
<li>比如企业级网站，主要功能是展示而没有复杂的交互，并且需要良好的 SO, 则这时我们就需要使用服务器端渲染</li>
<li>而类似后台管理项目，交互性比较强，不需要考虑 SO, 那么就可以使用前后端分离的开发模式。</li>
</ul>
<p>另外，具体使用何种开发模式并不是绝对的，为了同时兼顾了首页的渲染速度和前后端分离的开发效率，一些网站采用了首屏服务器端渲染 + 其他页面前后端分离的开发模式。</p>
<h2 id="身份认证"><a class="anchor" href="#身份认证">#</a> 身份认证</h2>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%202.png" alt="Untitled" /></p>
<h3 id="session"><a class="anchor" href="#session">#</a> Session</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%203.png" alt="Untitled" /></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%204.png" alt="Untitled" /></p>
<h3 id="session中间件"><a class="anchor" href="#session中间件">#</a> session 中间件</h3>
<figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'session'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">// 配置 Session 中间件</span></pre></td></tr><tr><td data-num="6"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">'keyboard cat'</span><span class="token punctuation">,</span> <span class="token comment">// 任意字符串</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>          <span class="token comment">// 固定写法</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// 固定写法</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">'80'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'running'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%205.png" alt="Untitled" /></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%206.png" alt="Untitled" /></p>
<h3 id="cookie"><a class="anchor" href="#cookie">#</a> cookie</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%207.png" alt="Untitled" /></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%208.png" alt="Untitled" /></p>
<h2 id="jwt"><a class="anchor" href="#jwt">#</a> JWT</h2>
<h3 id="基础"><a class="anchor" href="#基础">#</a> 基础</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%209.png" alt="Untitled" /></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2010.png" alt="Untitled" /></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2011.png" alt="Untitled" /></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2012.png" alt="Untitled" /></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2013.png" alt="Untitled" /></p>
<h3 id="在express中使用-jwt"><a class="anchor" href="#在express中使用-jwt">#</a> 在 Express 中使用 JWT</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2014.png" alt="Untitled" /></p>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2015.png" alt="Untitled" /></p>
<h3 id="在登录成功后生成jwt字符串"><a class="anchor" href="#在登录成功后生成jwt字符串">#</a> 在登录成功后生成 JWT 字符串</h3>
<figure class="highlight jsx"><figcaption data-lang="React JSX"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// 登录接口</span></pre></td></tr><tr><td data-num="2"></td><td><pre>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/api/login'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token comment">// 将 req.body 请求体中的数据，转存为 userinfo 常量</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token keyword">const</span> userinfo <span class="token operator">=</span> req<span class="token punctuation">.</span>body</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token comment">// 登录失败</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token keyword">if</span> <span class="token punctuation">(</span>userinfo<span class="token punctuation">.</span>username <span class="token operator">!==</span> <span class="token string">'admin'</span> <span class="token operator">||</span> userinfo<span class="token punctuation">.</span>password <span class="token operator">!==</span> <span class="token string">'000000'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">400</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'登录失败！'</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token comment">// 登录成功</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token comment">// TODO_03：在登录成功之后，调用 jwt.sign () 方法生成 JWT 字符串。并通过 token 属性发送给客户端</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token comment">// 参数 1：用户的信息对象</span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token comment">// 参数 2：加密的密钥</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token comment">// 参数 3：配置对象，可以配置当前 token 的有效期</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  <span class="token keyword">const</span> tokenStr <span class="token operator">=</span> jwt<span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> <span class="token literal-property property">username</span><span class="token operator">:</span> userinfo<span class="token punctuation">.</span>username <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> secretKey<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> <span class="token literal-property property">expiresIn</span><span class="token operator">:</span> <span class="token string">'30s'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token literal-property property">status</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">'登录成功！'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token literal-property property">token</span><span class="token operator">:</span> tokenStr <span class="token comment">// 要发送给客户端的 token 字符串</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="将jwt字符串还原为json对象"><a class="anchor" href="#将jwt字符串还原为json对象">#</a> 将 JWT 字符串还原为 JSON 对象</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2016.png" alt="Untitled" /></p>
<p>注意：在最新版本中 expressJWT 不是函数</p>
<h3 id="使用-requser-获取用户信息"><a class="anchor" href="#使用-requser-获取用户信息">#</a> 使用 req.user 获取用户信息</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2017.png" alt="Untitled" /></p>
<h3 id="捕获解析-jwt-失败后产生的错误"><a class="anchor" href="#捕获解析-jwt-失败后产生的错误">#</a> 捕获解析 JWT 失败后产生的错误</h3>
<p><img src="%E5%89%8D%E5%90%8E%E7%AB%AF%E7%9A%84%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%203444a27986d0408bbe7a2ac85e514852/Untitled%2018.png" alt="Untitled" /></p>
